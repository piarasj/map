<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>MapaLister</title>
  <meta name="description" content="Transform your data into beautiful, interactive maps with powerful listing and search capabilities">
  
  <!-- Enhanced viewport for iOS compatibility -->
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover, shrink-to-fit=no" />
  
  <!-- Favicon and App Icons -->
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNIDYgMCBMIDI2IDAgQSA2IDYgMCAwIDEgMzIgNiBMIDMyIDE2IEwgMTYgMTYgTCAxNiAzIEEgMiAyIDAgMCAwIDE0IDEgTCA2IDEgQSA2IDYgMCAwIDEgNiAwIiBmaWxsPSIjZTExZDQ4Ii8+CiAgPHBhdGggZD0iTSAzMiAxNiBMIDMyIDI2IEEgNiA2IDAgMCAxIDI2IDMyIEwgMTYgMzIgTCAxNiAxNiIgZmlsbD0iIzEwYjk4MSIvPgogIDxwYXRoIGQ9Ik0gMTYgMzIgTCA2IDMyIEEgNiA2IDAgMCAxIDAgMjYgTCAwIDE2IEwgMTYgMTYiIGZpbGw9IiMzYjgyZjYiLz4KICA8cGF0aCBkPSJNIDAgMTYgTCAwIDYgQSA2IDYgMCAwIDEgNiAwIEwgMTYgMCBMIDE2IDE2IiBmaWxsPSIjZjU5ZTBiIi8+CiAgPHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjI2IiBoZWlnaHQ9IjI2IiByeD0iMiIgZmlsbD0id2hpdGUiLz4KICA8dGV4dCB4PSIxNiIgeT0iMjUuNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMy40IiBkb21pbmFudC1iYXNlbGluZT0iYmFzZWxpbmUiPvCfk408L3RleHQ+Cjwvc3ZnPg==">
  <link rel="icon" type="image/png" sizes="32x32" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAABhGlDQ1BJQ0MgcHJvZmlsZQAAKJF9kT1Iw0AcxV9TpSIVBzuIOGSoTnZREcdahSJUCLVCqw4ml36hSUOS4uIouBYc/FisOrg46+rgKgiCHyCuLk4KLVLi/5JCixgPjvvx7t7H3TtAaFSZZnWNAZpum6lEXMxkV8XAK7rQhwBCiMrMMuYkKQXP8XUPH9/vYjzL+9yfo0fNWQzwicSzzDBt4g3i6U3b4LxPHGFFSSU+Jx4z6YLEj1xXGn7jXHDZz3MjZjo1TxwhFgptLLcxKxoq8RRxVFE1yvdnHFY4b3FWy1XWvCd/YSinryxzneYQElhECRIkKKiihDJsxGjVSTGRov24h3/E8UvkUsmVhJGjgAo0SLdfPPjf4PdardlJJeSSMNj54jgfA4HdQLOu49ePHad5AvifgSu943VtA7Mfgde7th4+AkLbwMV115xduOMe6E89FyPVHuiRgb4wgPdlpCbVwK0lPTn7xSlcB1JdqzbcAPs+AeM3+zY2Hw9PgA=">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#10b981">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="MapaLister">
  
  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="MapaLister - Interactive Data Mapping">
  <meta property="og:description" content="Transform your data into beautiful, interactive maps with powerful listing and search capabilities">
  <meta property="og:image" content="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8cGF0aCBkPSJNIDYgMCBMIDI2IDAgQSA2IDYgMCAwIDEgMzIgNiBMIDMyIDE2IEwgMTYgMTYgTCAxNiAzIEEgMiAyIDAgMCAwIDE0IDEgTCA2IDEgQSA2IDYgMCAwIDEgNiAwIiBmaWxsPSIjZTExZDQ4Ii8+CiAgPHBhdGggZD0iTSAzMiAxNiBMIDMyIDI2IEEgNiA2IDAgMCAxIDI2IDMyIEwgMTYgMzIgTCAxNiAxNiIgZmlsbD0iIzEwYjk4MSIvPgogIDxwYXRoIGQ9Ik0gMTYgMzIgTCA2IDMyIEEgNiA2IDAgMCAxIDAgMjYgTCAwIDE2IEwgMTYgMTYiIGZpbGw9IiMzYjgyZjYiLz4KICA8cGF0aCBkPSJNIDAgMTYgTCAwIDYgQSA2IDYgMCAwIDEgNiAwIEwgMTYgMCBMIDE2IDE2IiBmaWxsPSIjZjU5ZTBiIi8+CiAgPHJlY3QgeD0iMyIgeT0iMyIgd2lkdGg9IjI2IiBoZWlnaHQ9IjI2IiByeD0iMiIgZmlsbD0id2hpdGUiLz4KICA8dGV4dCB4PSIxNiIgeT0iMjUuNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1zaXplPSIyMy40IiBkb21pbmFudC1iYXNlbGluZT0iYmFzZWxpbmUiPvCfk408L3RleHQ+Cjwvc3ZnPg==">
  
  <!-- Mapbox and Fonts -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
 <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>

  <!-- CSS Files -->
  <link rel="stylesheet" href="css/map.css">
  <link rel="stylesheet" href="css/multi-select-dropdown.css">

<!-- Replace all icons with Heroicons some time
<script src="https://unpkg.com/heroicons@2.0.18/24/outline/index.js"></script>
 -->

  <!-- iOS-specific styles -->
  <style>
    /* iOS Safari optimizations */
    body {
      -webkit-overflow-scrolling: auto;
      overflow: hidden;
      position: fixed;
      width: 100%;
      height: 100%;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    #map {
      -webkit-overflow-scrolling: auto;
      touch-action: pan-x pan-y;
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -webkit-tap-highlight-color: transparent;
    }
    
    .mapboxgl-canvas {
      -webkit-transform: translateZ(0);
      transform: translateZ(0);
      -webkit-backface-visibility: hidden;
      backface-visibility: hidden;
    }
    
    /* iOS Safari specific canvas optimizations */
    @media screen and (-webkit-min-device-pixel-ratio: 2) {
      .mapboxgl-canvas {
        image-rendering: -webkit-optimize-contrast;
        image-rendering: optimizeSpeed;
      }
    }
    
    /* iOS viewport handling */
    @supports (padding: max(0px)) {
      body {
        padding-left: env(safe-area-inset-left);
        padding-right: env(safe-area-inset-right);
        padding-top: env(safe-area-inset-top);
        padding-bottom: env(safe-area-inset-bottom);
      }
    }
  </style>

  <!-- JavaScript Libraries -->
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
  <script>
    mapboxgl.accessToken = 'pk.eyJ1IjoicGlhcmFzaiIsImEiOiJjbWJsY2hieWMweXFtMnBwamlkOHV6ZHgxIn0.h0_O_8P6oAeobHAUGPVZNg';
  </script>

</head>
<body>

  <div id="reference-marker-info"></div>
  <div id="map"></div>

  <div class="sidebar">
    <!-- MapaLister Logo with Dynamic Pin -->
    <div class="app-logo">
      <svg id="dynamicPinLogo" width="40" height="40" viewBox="0 0 32 32">
        <g id="normalIcon">
          <path d="M 6 0 L 26 0 A 6 6 0 0 1 32 6 L 32 16 L 16 16 L 16 3 A 2 2 0 0 0 14 1 L 6 1 A 6 6 0 0 1 6 0" fill="#e11d48"/>
          <path d="M 32 16 L 32 26 A 6 6 0 0 1 26 32 L 16 32 L 16 16" fill="#10b981"/>
          <path d="M 16 32 L 6 32 A 6 6 0 0 1 0 26 L 0 16 L 16 16" fill="#3b82f6"/>
          <path d="M 0 16 L 0 6 A 6 6 0 0 1 6 0 L 16 0 L 16 16" fill="#f59e0b"/>
          <rect x="3" y="3" width="26" height="26" rx="2" fill="white"/>
          <text x="16" y="25.4" text-anchor="middle" font-size="23.4" dominant-baseline="baseline" class="pin-emoji">üìç</text>
        </g>
        <circle id="notificationDot" cx="26" cy="6" r="4" fill="#ef4444" stroke="white" stroke-width="1" opacity="0"/>
      </svg>
      
      <div class="logo-text">
        <span class="map">Map</span><span class="a">a</span><span class="list">List</span><span class="er">er</span>
      </div>
    </div>

    <!-- Dataset Selector -->
    <div class="dataset-selector">
      <div class="selector-button" id="selectorButton">
        <span class="selector-text placeholder" id="selectorText">Ready for data upload...</span>
        <span class="selector-arrow" id="selectorArrow">‚ñº</span>
      </div>
      
<div class="dropdown-menu" id="dropdownMenu">
  <div class="loading" style="padding: 20px; text-align: center; color: #666;">
    Ready for data upload...
  </div>
</div>

    <!-- Listings -->
 <div id="listings">
  <div class="loading">Ready for data upload...</div>
</div>
</div>

<!-- SCRIPT LOADING ORDER -->

<!-- 1. CORE UTILITIES FIRST (all utilities and dependencies) -->
<script src="utils/lucide-utils.js"></script>          <!-- MOVED UP - needed by many managers -->
<script src="config/distance-utils.js"></script>
<!-- 
<script src="utlis/clean-marker-system.js"></script>
 -->
<script src="managers/reference-marker.js"></script>
<script src="utils/popup-utils.js"></script>
<!-- 
<script src="utlis/marker-system.js"></script>
 -->

<!-- 
<script src="utils/icon-tagging-system.js"></script>
 -->

<!-- 2. CONFIGURATION (data and app configuration) -->
<script src="config/data-config.js"></script>

<!-- 3. MANAGERS (in dependency order) -->
<script src="managers/style-manager.js"></script>
<script src="managers/keyboard-manager.js"></script>
<script src="managers/welcome-overlay-manager.js"></script>
<script src="managers/settings-manager.js"></script>    <!-- MOVED UP - provides config for others -->
<script src="managers/settings-overlays.js"></script>   <!-- ADD THIS - Irish overlays -->
<script src="managers/settings-modal.js"></script>      <!-- ADD THIS - Modal UI -->
<script src="managers/unified-map-manager.js"></script>  <!-- Now has all dependencies -->
<script src="managers/data-manager.js"></script>
<script src="managers/sidebar-manager.js"></script>
<script src="managers/file-upload-manager.js"></script>
<script src="managers/user-display-manager.js"></script>
<script src="scripts/notification-system.js"></script>

<!-- 4. MAIN INTEGRATION (the conductor - loads last) -->
<script src="scripts/main-integration.js"></script>
<!-- Load this LAST, after all other scripts -->

<!-- Debug script for dataset selector -->
<script src="debug-dataset-selector.js"></script>
<!-- 
<script src="utils/simple-flag-visibility.js"></script>
 -->
<!-- Simple Save Integration -->
<!-- Later
Save button in settings modal (settings-manager.js)
Ctrl+S shortcut (keyboard-manager.js)
Status indicators (file-upload-manager.js)
 -->


<script>
// Add Ctrl+S shortcut and UI integration
(function() {
  document.addEventListener('keydown', (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === 's' && !e.target.matches('input, textarea')) {
      e.preventDefault();
      if (window.FileUploadManager?.downloadDataWithSettings) {
        window.FileUploadManager.downloadDataWithSettings();
      }
    }
  });
})();
</script>

  <!-- iOS Safari Fix -->
  <script>
    // Detect iOS devices
    const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) || 
                  (navigator.platform === 'MacIntel' && navigator.maxTouchPoints > 1);
    
    if (isIOS) {
      console.log('üì± iOS device detected - loading iOS compatibility fixes');
      
      // Load iOS fixes after main scripts
      const iosScript = document.createElement('script');
      iosScript.src = 'scripts/ios-safari-fixes.js';
      iosScript.async = false;
      document.head.appendChild(iosScript);
      
      // Prevent standard initialization on iOS
      window.mapaListerInitializing = true;
    }
  </script>
  
 
</body>
</html>